<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Desarrollo del reto SUNLAB. | Hackathon Talento - Reto 1 - SUNLAB</title>
  <meta name="description" content="2 Desarrollo del reto SUNLAB. | Hackathon Talento - Reto 1 - SUNLAB" />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Desarrollo del reto SUNLAB. | Hackathon Talento - Reto 1 - SUNLAB" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Desarrollo del reto SUNLAB. | Hackathon Talento - Reto 1 - SUNLAB" />
  
  
  

<meta name="author" content="Sergio Berdiales, Javier Campos y Manuel Antonio García" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="planteamiento-del-reto-sunlab-.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introducción</a></li>
<li class="chapter" data-level="1" data-path="planteamiento-del-reto-sunlab-.html"><a href="planteamiento-del-reto-sunlab-.html"><i class="fa fa-check"></i><b>1</b> Planteamiento del reto SUNLAB.</a></li>
<li class="chapter" data-level="2" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html"><i class="fa fa-check"></i><b>2</b> Desarrollo del reto SUNLAB.</a><ul>
<li class="chapter" data-level="2.1" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#carga-de-las-librerias-necesarias."><i class="fa fa-check"></i><b>2.1</b> Carga de las librerias necesarias.</a></li>
<li class="chapter" data-level="2.2" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#importacion-de-los-datos."><i class="fa fa-check"></i><b>2.2</b> Importación de los datos.</a><ul>
<li class="chapter" data-level="2.2.1" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#datos-train."><i class="fa fa-check"></i><b>2.2.1</b> Datos “train”.</a></li>
<li class="chapter" data-level="2.2.2" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#datos-test."><i class="fa fa-check"></i><b>2.2.2</b> Datos “test”.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#exploracion-y-tratamiento-de-los-datos."><i class="fa fa-check"></i><b>2.3</b> Exploración y tratamiento de los datos.</a><ul>
<li class="chapter" data-level="2.3.1" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#tablas-en-formato-largo"><i class="fa fa-check"></i><b>2.3.1</b> Tablas en formato largo</a></li>
<li class="chapter" data-level="2.3.2" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#formato-semi-largo"><i class="fa fa-check"></i><b>2.3.2</b> Formato semi-largo</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#generacion-de-modelos-base-con-r."><i class="fa fa-check"></i><b>2.4</b> Generación de modelos base con R.</a><ul>
<li class="chapter" data-level="2.4.1" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#modelos-base-para-paneles-a"><i class="fa fa-check"></i><b>2.4.1</b> Modelos base para paneles A</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="desarrollo-del-reto-sunlab-.html"><a href="desarrollo-del-reto-sunlab-.html#descripcion-de-la-generacion-de-los-modelos-con-bigml."><i class="fa fa-check"></i><b>2.5</b> Descripción de la generación de los modelos con BIGml.</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Hackathon Talento - Reto 1 - SUNLAB</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="desarrollo-del-reto-sunlab." class="section level1">
<h1><span class="header-section-number">2</span> Desarrollo del reto SUNLAB.</h1>
<div id="carga-de-las-librerias-necesarias." class="section level2">
<h2><span class="header-section-number">2.1</span> Carga de las librerias necesarias.</h2>
<p>Cargamos los paquetes que vamos a necesitar para el análisis</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(readxl)
<span class="kw">library</span>(VIM)
<span class="kw">library</span>(GGally)
<span class="kw">library</span>(caret)</code></pre>
</div>
<div id="importacion-de-los-datos." class="section level2">
<h2><span class="header-section-number">2.2</span> Importación de los datos.</h2>
<div id="datos-train." class="section level3">
<h3><span class="header-section-number">2.2.1</span> Datos “train”.</h3>
<p>Los cuatro archivos de “train” facilitados en formato xls parecían tener algún tipo de problema. No fuimos capaces de importarlo en R en ese formato. Así que los convertimos previamente en formato csv. En este ocasión lo que hemos hecho es ir a la <a href="https://opendata.edp.com/explore/?refine.keyword=visible&amp;sort=modified">página de EDP de Open Data</a> y descargar los archivos directamente en formato csv.</p>
<p>Estos archivos csv utilizan como separador el punto y coma, en vez de la coma. Así que en este caso tendremos que utilizar la función read_delim() con el argumento delim = “;”.</p>
<pre class="sourceCode r"><code class="sourceCode r">meteo_<span class="dv">2015</span> &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="dt">file =</span> <span class="st">&quot;./data/train/sunlab-faro_meteo_2015.csv&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>)
meteo_<span class="dv">2016</span> &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="dt">file =</span> <span class="st">&quot;./data/train/sunlab-faro-meteo-2016.csv&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>)
prod_<span class="dv">2015</span> &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="dt">file =</span> <span class="st">&quot;./data/train/sunlab-faro-pv-2015.csv&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>)
prod_<span class="dv">2016</span> &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="dt">file =</span> <span class="st">&quot;./data/train/sunlab-faro-pv-2016.csv&quot;</span>, <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>)</code></pre>
</div>
<div id="datos-test." class="section level3">
<h3><span class="header-section-number">2.2.2</span> Datos “test”.</h3>
<p>En este caso las tablas a importar estaban en formato xlsx y no tuvimos ningún problema a la hora de importarlas. Así que esta vez utilizaremos los archivos facilitados durante el Hackathon.</p>
<pre class="sourceCode r"><code class="sourceCode r">test_meteo_<span class="dv">2017</span> &lt;-<span class="st"> </span><span class="kw">read_xlsx</span>(<span class="dt">path =</span> <span class="st">&quot;./data/test/test-sunlab-meteo-2017.xlsx&quot;</span>)
test_prod_<span class="dv">2017</span> &lt;-<span class="st"> </span><span class="kw">read_xlsx</span>(<span class="dt">path =</span> <span class="st">&quot;./data/test/test-sunlab-pv-2017.xlsx&quot;</span>)</code></pre>
</div>
</div>
<div id="exploracion-y-tratamiento-de-los-datos." class="section level2">
<h2><span class="header-section-number">2.3</span> Exploración y tratamiento de los datos.</h2>
<p>Unimos las tablas de distintos años de meteo y producción y nos quedamos con dos únicas tablas de train.</p>
<pre class="sourceCode r"><code class="sourceCode r">meteo_<span class="dv">2015</span>_<span class="dv">2016</span> &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(meteo_<span class="dv">2015</span>, meteo_<span class="dv">2016</span>)
prod_<span class="dv">2015</span>_<span class="dv">2016</span> &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(prod_<span class="dv">2015</span>, prod_<span class="dv">2016</span>)</code></pre>
<p>Borramos las tablas anteriores de train para que no nos ocupen espacio en memoria</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(meteo_<span class="dv">2015</span>)
<span class="kw">rm</span>(meteo_<span class="dv">2016</span>)
<span class="kw">rm</span>(prod_<span class="dv">2015</span>)
<span class="kw">rm</span>(prod_<span class="dv">2016</span>)</code></pre>
<p>Echamos un vistazo a las variables y observaciones de la tabla de producción.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(prod_<span class="dv">2015</span>_<span class="dv">2016</span>)</code></pre>
<pre><code>## Observations: 420,507
## Variables: 25
## $ Datetime                          &lt;dttm&gt; 2015-01-09 12:52:00, 2015-0...
## $ `A_Vertical - Voltage DC [V]`     &lt;dbl&gt; 29.35, 29.10, 29.10, 29.35, ...
## $ `A_Vertical - Current DC [A]`     &lt;dbl&gt; 6.4125, 6.3975, 6.3325, 6.41...
## $ `A_Vertical - Power DC [W]`       &lt;dbl&gt; 188.206875, 186.167250, 184....
## $ `A_Optimal - Voltage DC [V]`      &lt;dbl&gt; 28.75, 28.45, 28.45, 28.75, ...
## $ `A_Optimal - Current DC [A]`      &lt;dbl&gt; 7.1700, 7.1925, 7.0925, 7.21...
## $ `A_Optimal - Power DC [W]`        &lt;dbl&gt; 206.13750, 204.62662, 201.78...
## $ `A_Horizontal - Voltage DC [V]`   &lt;dbl&gt; 29.25, 29.50, 29.45, 29.50, ...
## $ `A_Horizontal - Current DC [A]`   &lt;dbl&gt; 4.3225, 4.2525, 4.1825, 4.30...
## $ `A_Horizontal - Power DC [W]`     &lt;dbl&gt; 126.43313, 125.44875, 123.17...
## $ `A_Vertical - Temperature [ºC]`   &lt;dbl&gt; 32.6, 32.4, 33.2, 32.2, 32.8...
## $ `A_Optimal - Temperature [ºC]`    &lt;dbl&gt; 28.8, 28.6, 29.4, 28.2, 27.8...
## $ `A_Horizontal - Temperature [ºC]` &lt;dbl&gt; 26.5, 26.1, 26.8, 26.4, 26.1...
## $ `B_Vertical - Voltage DC [V]`     &lt;dbl&gt; 27.55, 27.60, 27.40, 27.40, ...
## $ `B_Vertical - Current DC [A]`     &lt;dbl&gt; 7.0925, 7.0475, 7.0100, 7.14...
## $ `B_Vertical - Power DC [W]`       &lt;dbl&gt; 195.39837, 194.51100, 192.07...
## $ `B_Optimal - Voltage DC [V]`      &lt;dbl&gt; 27.85, 28.05, 27.85, 28.05, ...
## $ `B_Optimal - Current DC [A]`      &lt;dbl&gt; 7.2225, 7.1125, 7.0450, 7.17...
## $ `B_Optimal - Power DC [W]`        &lt;dbl&gt; 201.14663, 199.50563, 196.20...
## $ `B_Horizontal - Voltage DC [V]`   &lt;dbl&gt; 29.05, 29.05, 28.75, 28.95, ...
## $ `B_Horizontal - Current DC [A]`   &lt;dbl&gt; 4.1775, 4.1275, 4.1125, 4.19...
## $ `B_Horizontal - Power DC [W]`     &lt;dbl&gt; 121.356375, 119.903875, 118....
## $ `B_Vertical - Temperature [ºC]`   &lt;dbl&gt; 31.2, 31.5, 31.9, 31.7, 32.2...
## $ `B_Optimal - Temperature [ºC]`    &lt;dbl&gt; 30.2, 30.0, 30.9, 29.9, 30.7...
## $ `B_Horizontal - Temperature [ºC]` &lt;dbl&gt; 25.3, 24.9, 25.7, 25.1, 25.6...</code></pre>
<p>Vemos también los primeros 10 registros.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(prod_<span class="dv">2015</span>_<span class="dv">2016</span>, <span class="dv">10</span>)</code></pre>
<pre><code>## # A tibble: 10 x 25
##    Datetime            `A_Vertical - V~ `A_Vertical - C~ `A_Vertical - P~
##    &lt;dttm&gt;                         &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 2015-01-09 12:52:00             29.4             6.41             188.
##  2 2015-01-09 12:14:00             29.1             6.40             186.
##  3 2015-01-09 13:19:00             29.1             6.33             184.
##  4 2015-01-09 12:41:00             29.4             6.41             188.
##  5 2015-01-09 13:07:00             29.1             6.40             186.
##  6 2015-01-09 12:57:00             29               6.46             187.
##  7 2015-01-09 13:04:00             29.3             6.40             187.
##  8 2015-01-09 13:20:00             29.1             6.32             184.
##  9 2015-01-09 13:16:00             29.1             6.38             186.
## 10 2015-01-09 12:48:00             29.3             6.44             189.
## # ... with 21 more variables: `A_Optimal - Voltage DC [V]` &lt;dbl&gt;,
## #   `A_Optimal - Current DC [A]` &lt;dbl&gt;, `A_Optimal - Power DC [W]` &lt;dbl&gt;,
## #   `A_Horizontal - Voltage DC [V]` &lt;dbl&gt;, `A_Horizontal - Current DC
## #   [A]` &lt;dbl&gt;, `A_Horizontal - Power DC [W]` &lt;dbl&gt;, `A_Vertical -
## #   Temperature [ºC]` &lt;dbl&gt;, `A_Optimal - Temperature [ºC]` &lt;dbl&gt;,
## #   `A_Horizontal - Temperature [ºC]` &lt;dbl&gt;, `B_Vertical - Voltage DC
## #   [V]` &lt;dbl&gt;, `B_Vertical - Current DC [A]` &lt;dbl&gt;, `B_Vertical - Power
## #   DC [W]` &lt;dbl&gt;, `B_Optimal - Voltage DC [V]` &lt;dbl&gt;, `B_Optimal -
## #   Current DC [A]` &lt;dbl&gt;, `B_Optimal - Power DC [W]` &lt;dbl&gt;, `B_Horizontal
## #   - Voltage DC [V]` &lt;dbl&gt;, `B_Horizontal - Current DC [A]` &lt;dbl&gt;,
## #   `B_Horizontal - Power DC [W]` &lt;dbl&gt;, `B_Vertical - Temperature
## #   [ºC]` &lt;dbl&gt;, `B_Optimal - Temperature [ºC]` &lt;dbl&gt;, `B_Horizontal -
## #   Temperature [ºC]` &lt;dbl&gt;</code></pre>
<p>¿Cada cuánto tiempo está registrada una medición en la tabla?</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Si fuese una medición cada minuto el número de mediciones entre 2015 y 2016 sería 1.051.200, y en la tabla solo hay 420.507 registros:</span>

<span class="dv">2</span><span class="op">*</span><span class="dv">365</span><span class="op">*</span><span class="dv">24</span><span class="op">*</span><span class="dv">60</span></code></pre>
<pre><code>## [1] 1051200</code></pre>
<p>Si vemos el conteo de registros por año vemos que en 2016 hay sensiblemente menos registros que en 2015.</p>
<pre class="sourceCode r"><code class="sourceCode r">registers_by_year &lt;-<span class="st"> </span>prod_<span class="dv">2015</span>_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">select</span>(Datetime) <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">group_by</span>(<span class="dt">year =</span> <span class="kw">year</span>(prod_<span class="dv">2015</span>_<span class="dv">2016</span><span class="op">$</span>Datetime)) <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">summarise</span>(<span class="dt">registers =</span> <span class="kw">n</span>())

registers_by_year</code></pre>
<pre><code>## # A tibble: 2 x 2
##    year registers
##   &lt;int&gt;     &lt;int&gt;
## 1  2015    242735
## 2  2016    177772</code></pre>
<p>Vemos la distribución por año-mes</p>
<pre class="sourceCode r"><code class="sourceCode r">registers_by_year_month &lt;-<span class="st"> </span>prod_<span class="dv">2015</span>_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                      </span><span class="kw">select</span>(Datetime) <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">group_by</span>(<span class="dt">year =</span> <span class="kw">year</span>(prod_<span class="dv">2015</span>_<span class="dv">2016</span><span class="op">$</span>Datetime),
                               <span class="dt">month =</span> <span class="kw">month</span>(prod_<span class="dv">2015</span>_<span class="dv">2016</span><span class="op">$</span>Datetime)) <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">summarise</span>(<span class="dt">registers =</span> <span class="kw">n</span>())

registers_by_year_month</code></pre>
<pre><code>## # A tibble: 21 x 3
## # Groups:   year [2]
##     year month registers
##    &lt;int&gt; &lt;int&gt;     &lt;int&gt;
##  1  2015     1     18730
##  2  2015     2     18297
##  3  2015     3     21094
##  4  2015     4     23460
##  5  2015     5     26183
##  6  2015     6     25146
##  7  2015     7     25908
##  8  2015     8     25252
##  9  2015     9     22380
## 10  2015    10     19067
## # ... with 11 more rows</code></pre>
<p>Hay bastantes variaciones en el número de registros de cada mes. Esto podría introducir sesgos a la hora de modelar, ya que en principio no sabemos a qué se deben estas variaciones. A destacar que en diciembre de 2015 no hay ningún registro y el bajísimo número de registros del mes de marzo de 2016.</p>
<pre class="sourceCode r"><code class="sourceCode r">registers_by_year_month_<span class="dv">1</span> &lt;-<span class="st"> </span>registers_by_year_month <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                              </span><span class="kw">mutate</span>(<span class="dt">day =</span> <span class="st">&quot;01&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                              </span><span class="kw">unite</span>(year_month, year, month, day, <span class="dt">sep =</span> <span class="st">&#39;-&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">                              </span><span class="kw">mutate</span>(<span class="dt">year_month =</span> <span class="kw">ymd</span>(year_month))

<span class="kw">ggplot</span>(<span class="dt">data =</span> registers_by_year_month_<span class="dv">1</span>, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(year_month), <span class="dt">y =</span> registers, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">          </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">          </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>,<span class="dt">hjust=</span><span class="dv">1</span>,<span class="dt">vjust=</span><span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">10</span>))</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(registers_by_year_month_<span class="dv">1</span>) </code></pre>
<pre><code>##    year_month           registers    
##  Min.   :2015-01-01   Min.   :  342  
##  1st Qu.:2015-06-01   1st Qu.:18250  
##  Median :2015-11-01   Median :19067  
##  Mean   :2015-12-05   Mean   :20024  
##  3rd Qu.:2016-07-01   3rd Qu.:25146  
##  Max.   :2016-12-01   Max.   :26682</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(registers_by_year_month_<span class="dv">1</span>) </code></pre>
<pre><code>##    year_month           registers    
##  Min.   :2015-01-01   Min.   :  342  
##  1st Qu.:2015-06-01   1st Qu.:18250  
##  Median :2015-11-01   Median :19067  
##  Mean   :2015-12-05   Mean   :20024  
##  3rd Qu.:2016-07-01   3rd Qu.:25146  
##  Max.   :2016-12-01   Max.   :26682</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> registers_by_year_month_<span class="dv">1</span>, <span class="kw">aes</span>(<span class="dt">x =</span> registers)) <span class="op">+</span>
<span class="st">          </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">23</span>) </code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Todos los meses, excepto 2, se encuentran entre los 18.000 y 27.000 registros. Lo que parece significar que más o menos hay un registro cada aproximadamente 2 minutos.</p>
<p>Vamos a estimar la frecuencia de los registros. Para ello restaremos a cada Datetime de cada registro su correspondiente Datetime anterior (Datetime_lagged) creando la variable time_diff, que nos dirá los minutos trascurridos entre cada registro.
Una vez hecho esto hacemos un simple conteo de todas las diferencias entre registros.</p>
<pre class="sourceCode r"><code class="sourceCode r">register_frequency &lt;-<span class="st"> </span>prod_<span class="dv">2015</span>_<span class="dv">2016</span> <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">select</span>(Datetime) <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">arrange</span>(Datetime) <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">mutate</span>(<span class="dt">Datetime_lagged =</span> <span class="kw">lag</span>(Datetime)) <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">mutate</span>(<span class="dt">time_diff =</span> Datetime <span class="op">-</span><span class="st"> </span>Datetime_lagged) <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">na.omit</span>()

intervals_count &lt;-<span class="st"> </span>register_frequency <span class="op">%&gt;%</span>
<span class="st">                   </span><span class="kw">select</span>(time_diff) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                   </span><span class="kw">group_by</span>(time_diff) <span class="op">%&gt;%</span>
<span class="st">                   </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">                   </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))

<span class="kw">head</span>(intervals_count, <span class="dv">20</span>)</code></pre>
<pre><code>## # A tibble: 20 x 2
##    time_diff      n
##    &lt;time&gt;     &lt;int&gt;
##  1   1 mins  419840
##  2   2 mins      29
##  3   6 mins      11
##  4   7 mins      11
##  5 579 mins      10
##  6   8 mins       9
##  7 566 mins       9
##  8 565 mins       8
##  9 572 mins       8
## 10 855 mins       8
## 11 569 mins       7
## 12 854 mins       7
## 13 570 mins       6
## 14 587 mins       6
## 15 777 mins       6
## 16 809 mins       6
## 17 833 mins       6
## 18 563 mins       5
## 19 568 mins       5
## 20 577 mins       5</code></pre>
<p>Lo que vemos es que en principio parece que el registro de mediciones está programado para realizarse cada minuto, porque este es con diferencia el intervalo entre registros más frecuente.</p>
<div id="tablas-en-formato-largo" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Tablas en formato largo</h3>
<p>Respecto al formato de las variables parecen todas tener el formato adecuado. Lo único que llama la atención es cómo distingue qué valores corresponden a los paneles de tipo A de los de tipo B, con una “A” o una “B” al principio de cada nombre de variable, y cómo incluye también la información de la orientación, también en el nombre de la variable, con los términos “Horizontal”, “Vertical” y “Optimal”. Quizás una forma mejor de ordenar los datos sería creando otras dos variables de formato factor, una para distinguir los paneles y otra la configuración.</p>
<p>Para ello lo primero que haremos será transformar a formato “largo” la tabla, reduciendo las 25 variables actuales a únicamente 2: ‘Datetime’ y ‘Measure’. Y justo después de esta transformación creamos tres nuevas variables que se referirán al tipo de panel (panel_type), la configuración del mismo (set_type) y finalmente el tipo de medición en cuestión (measure).</p>
<p>A continuación simplemente mostramos cómo quedará la tabla en formato “largo”.</p>
<pre class="sourceCode r"><code class="sourceCode r">prod_<span class="dv">2015</span>_<span class="dv">2016</span>_long_example &lt;-<span class="st"> </span>prod_<span class="dv">2015</span>_<span class="dv">2016</span> <span class="op">%&gt;%</span>
<span class="st">                                 </span><span class="kw">gather</span>(<span class="st">&#39;panel_set_measure&#39;</span>, <span class="st">&#39;value&#39;</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">25</span>) 

                        
<span class="kw">head</span>(prod_<span class="dv">2015</span>_<span class="dv">2016</span>_long_example, <span class="dv">10</span>)                           </code></pre>
<pre><code>## # A tibble: 10 x 3
##    Datetime            panel_set_measure           value
##    &lt;dttm&gt;              &lt;chr&gt;                       &lt;dbl&gt;
##  1 2015-01-09 12:52:00 A_Vertical - Voltage DC [V]  29.4
##  2 2015-01-09 12:14:00 A_Vertical - Voltage DC [V]  29.1
##  3 2015-01-09 13:19:00 A_Vertical - Voltage DC [V]  29.1
##  4 2015-01-09 12:41:00 A_Vertical - Voltage DC [V]  29.4
##  5 2015-01-09 13:07:00 A_Vertical - Voltage DC [V]  29.1
##  6 2015-01-09 12:57:00 A_Vertical - Voltage DC [V]  29  
##  7 2015-01-09 13:04:00 A_Vertical - Voltage DC [V]  29.3
##  8 2015-01-09 13:20:00 A_Vertical - Voltage DC [V]  29.1
##  9 2015-01-09 13:16:00 A_Vertical - Voltage DC [V]  29.1
## 10 2015-01-09 12:48:00 A_Vertical - Voltage DC [V]  29.3</code></pre>
<p>Y aquí el código completo para esta transformación.</p>
<pre class="sourceCode r"><code class="sourceCode r">prod_<span class="dv">2015</span>_<span class="dv">2016</span>_long &lt;-<span class="st"> </span>prod_<span class="dv">2015</span>_<span class="dv">2016</span> <span class="op">%&gt;%</span>
<span class="st">                                 </span><span class="kw">gather</span>(<span class="st">&#39;panel_set_measure&#39;</span>, <span class="st">&#39;value&#39;</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">25</span>) <span class="op">%&gt;%</span>
<span class="st">                                 </span><span class="kw">rename</span>(<span class="dt">datetime =</span> Datetime) <span class="op">%&gt;%</span>
<span class="st">                                 </span><span class="kw">mutate</span>(<span class="dt">panel_type =</span> <span class="kw">as.factor</span>(<span class="kw">str_sub</span>(panel_set_measure, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">end =</span> <span class="dv">1</span>)),
                                        <span class="dt">set_type =</span> <span class="kw">as.factor</span>(<span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Vertical&#39;</span>, panel_set_measure), <span class="st">&#39;Vertical&#39;</span>, 
                                                                    <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Horizontal&#39;</span>, panel_set_measure), <span class="st">&#39;Horizontal&#39;</span>, <span class="st">&#39;Optimal&#39;</span>))),
                                        <span class="dt">measure =</span> <span class="kw">as.factor</span>(<span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Temperature&#39;</span>, panel_set_measure), <span class="st">&#39;Temperature_DC_C&#39;</span>,
                                                                   <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Voltage&#39;</span>, panel_set_measure), <span class="st">&#39;Voltage_DC_V&#39;</span>, 
                                                                          <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Power&#39;</span>, panel_set_measure), <span class="st">&#39;Power_DC_W&#39;</span>, <span class="st">&#39;Current_DC_A&#39;</span>))))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                                </span><span class="kw">select</span>(<span class="op">-</span>panel_set_measure)</code></pre>
<p>Así ya nos queda una tabla con un formato más ordenado.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(prod_<span class="dv">2015</span>_<span class="dv">2016</span>_long, <span class="dv">10</span>)                           </code></pre>
<pre><code>## # A tibble: 10 x 5
##    datetime            value panel_type set_type measure     
##    &lt;dttm&gt;              &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;    &lt;fct&gt;       
##  1 2015-01-09 12:52:00  29.4 A          Vertical Voltage_DC_V
##  2 2015-01-09 12:14:00  29.1 A          Vertical Voltage_DC_V
##  3 2015-01-09 13:19:00  29.1 A          Vertical Voltage_DC_V
##  4 2015-01-09 12:41:00  29.4 A          Vertical Voltage_DC_V
##  5 2015-01-09 13:07:00  29.1 A          Vertical Voltage_DC_V
##  6 2015-01-09 12:57:00  29   A          Vertical Voltage_DC_V
##  7 2015-01-09 13:04:00  29.3 A          Vertical Voltage_DC_V
##  8 2015-01-09 13:20:00  29.1 A          Vertical Voltage_DC_V
##  9 2015-01-09 13:16:00  29.1 A          Vertical Voltage_DC_V
## 10 2015-01-09 12:48:00  29.3 A          Vertical Voltage_DC_V</code></pre>
<p>Echamos un vistazo con un summary()</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(prod_<span class="dv">2015</span>_<span class="dv">2016</span>_long)</code></pre>
<pre><code>##     datetime                       value        panel_type 
##  Min.   :2015-01-01 07:40:00   Min.   :  0.00   A:5046084  
##  1st Qu.:2015-05-28 18:54:00   1st Qu.:  6.50   B:5046084  
##  Median :2015-10-08 17:39:00   Median : 26.90              
##  Mean   :2015-12-04 18:29:34   Mean   : 35.51              
##  3rd Qu.:2016-07-19 14:48:00   3rd Qu.: 34.40              
##  Max.   :2016-12-29 17:31:00   Max.   :307.64              
##                                NA&#39;s   :183579              
##        set_type                   measure       
##  Horizontal:3364056   Current_DC_A    :2523042  
##  Optimal   :3364056   Power_DC_W      :2523042  
##  Vertical  :3364056   Temperature_DC_C:2523042  
##                       Voltage_DC_V    :2523042  
##                                                 
##                                                 
## </code></pre>
<p>Y aplicamos la misma transformación al dataset de test</p>
<pre class="sourceCode r"><code class="sourceCode r">test_prod_<span class="dv">2017</span>_long &lt;-<span class="st"> </span>test_prod_<span class="dv">2017</span> <span class="op">%&gt;%</span>
<span class="st">                                 </span><span class="kw">gather</span>(<span class="st">&#39;panel_set_measure&#39;</span>, <span class="st">&#39;value&#39;</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">25</span>) <span class="op">%&gt;%</span>
<span class="st">                                 </span><span class="kw">rename</span>(<span class="dt">datetime =</span> Datetime) <span class="op">%&gt;%</span>
<span class="st">                                 </span><span class="kw">mutate</span>(<span class="dt">panel_type =</span> <span class="kw">as.factor</span>(<span class="kw">str_sub</span>(panel_set_measure, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">end =</span> <span class="dv">1</span>)),
                                        <span class="dt">set_type =</span> <span class="kw">as.factor</span>(<span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Vertical&#39;</span>, panel_set_measure), <span class="st">&#39;Vertical&#39;</span>, 
                                                                    <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Horizontal&#39;</span>, panel_set_measure), <span class="st">&#39;Horizontal&#39;</span>, <span class="st">&#39;Optimal&#39;</span>))),
                                        <span class="dt">measure =</span> <span class="kw">as.factor</span>(<span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Temperature&#39;</span>, panel_set_measure), <span class="st">&#39;Temperature_DC_C&#39;</span>,
                                                                   <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Voltage&#39;</span>, panel_set_measure), <span class="st">&#39;Voltage_DC_V&#39;</span>, 
                                                                          <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;Power&#39;</span>, panel_set_measure), <span class="st">&#39;Power_DC_W&#39;</span>, <span class="st">&#39;Current_DC_A&#39;</span>))))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                                </span><span class="kw">select</span>(<span class="op">-</span>panel_set_measure)</code></pre>
<p>Este formato largo nos ayudará sobre todo a la hora de realizar visualizaciones con ggplot2, que requiere este tipo de estructura.</p>
</div>
<div id="formato-semi-largo" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Formato semi-largo</h3>
<p>También puede que necesitamos una estructura a medio camino entre las dos que tenemos hasta ahora. Que sería básicamente coger las tablas en formato largo y “extender” la variable “value” por tipo de “measure”.</p>
<p>Lo hacemos con los datos de train.</p>
<pre class="sourceCode r"><code class="sourceCode r">prod_<span class="dv">2015</span>_<span class="dv">2016</span>_semi_long &lt;-<span class="st"> </span>prod_<span class="dv">2015</span>_<span class="dv">2016</span>_long <span class="op">%&gt;%</span>
<span class="st">                                 </span><span class="kw">spread</span>(measure, value) 

<span class="kw">head</span>(prod_<span class="dv">2015</span>_<span class="dv">2016</span>_semi_long)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   datetime            panel_type set_type Current_DC_A Power_DC_W
##   &lt;dttm&gt;              &lt;fct&gt;      &lt;fct&gt;           &lt;dbl&gt;      &lt;dbl&gt;
## 1 2015-01-01 07:40:00 A          Horizon~           NA         NA
## 2 2015-01-01 07:40:00 A          Optimal            NA         NA
## 3 2015-01-01 07:40:00 A          Vertical           NA         NA
## 4 2015-01-01 07:40:00 B          Horizon~           NA         NA
## 5 2015-01-01 07:40:00 B          Optimal            NA         NA
## 6 2015-01-01 07:40:00 B          Vertical           NA         NA
## # ... with 2 more variables: Temperature_DC_C &lt;dbl&gt;, Voltage_DC_V &lt;dbl&gt;</code></pre>
<p>Y con los de test.</p>
<pre class="sourceCode r"><code class="sourceCode r">test_prod_<span class="dv">2017</span>_semi_long &lt;-<span class="st"> </span>test_prod_<span class="dv">2017</span>_long <span class="op">%&gt;%</span>
<span class="st">                                  </span><span class="kw">spread</span>(measure, value)

<span class="kw">head</span>(test_prod_<span class="dv">2017</span>_semi_long)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   datetime panel_type set_type Current_DC_A Power_DC_W Temperature_DC_C
##   &lt;chr&gt;    &lt;fct&gt;      &lt;fct&gt;           &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;
## 1 2017-01~ A          Horizon~       0.065        1.22              3.3
## 2 2017-01~ A          Optimal        0.108       NA                 4  
## 3 2017-01~ A          Vertical       0.075        1.44              4.5
## 4 2017-01~ B          Horizon~       0.108        2.31              3.2
## 5 2017-01~ B          Optimal        0.0825      NA                 4.1
## 6 2017-01~ B          Vertical       0.07         1.32              4.8
## # ... with 1 more variable: Voltage_DC_V &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="generacion-de-modelos-base-con-r." class="section level2">
<h2><span class="header-section-number">2.4</span> Generación de modelos base con R.</h2>
<p>El problema a resolver es predecir la producción eléctrica en Watios que pueden generar los paneles A y B en su orientación óptima durante los siete primeros días del año 2017.</p>
<p>Antes de ver la influencia que puede tener los datos meteorológicos en la producción vamos a intentar ver si simplemente con los datos que tenemos en la tabla de producción podemos hacer ya alguna aproximación.</p>
<p>Para ello vamos a dividir la tabla de producción que tenemos en formato semilargo en dos datasets, uno para realizar el training y otro para ir realizando validaciones de los modelos y poder detectar problemas de overfitting.</p>
<p>Train period: 01-01-2015 - 30-09-2016
Validation period: 01-10-2016 - 31-12-2016</p>
<div id="modelos-base-para-paneles-a" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Modelos base para paneles A</h3>
<pre class="sourceCode r"><code class="sourceCode r">train_period_A &lt;-<span class="st"> </span>prod_<span class="dv">2015</span>_<span class="dv">2016</span>_semi_long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                  </span><span class="kw">filter</span>(datetime <span class="op">&lt;=</span><span class="st"> &#39;2016-09-30 23:59:59&#39;</span>,
                         panel_type <span class="op">==</span><span class="st"> &quot;A&quot;</span>,
                         set_type <span class="op">==</span><span class="st"> &quot;Optimal&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                  </span><span class="kw">select</span>(<span class="op">-</span>panel_type,
                         <span class="op">-</span>set_type) <span class="op">%&gt;%</span>
<span class="st">                  </span><span class="kw">na.omit</span>()

validation_period_A &lt;-<span class="st"> </span>prod_<span class="dv">2015</span>_<span class="dv">2016</span>_semi_long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                  </span><span class="kw">filter</span>(datetime <span class="op">&gt;</span><span class="st"> &#39;2016-09-30 23:59:59&#39;</span>,
                         panel_type <span class="op">==</span><span class="st"> &quot;A&quot;</span>,
                         set_type <span class="op">==</span><span class="st"> &quot;Optimal&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                  </span><span class="kw">select</span>(<span class="op">-</span>panel_type,
                         <span class="op">-</span>set_type) <span class="op">%&gt;%</span>
<span class="st">                  </span><span class="kw">na.omit</span>()</code></pre>
<p>Vemos la tabla</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(train_period_A)</code></pre>
<pre><code>## # A tibble: 6 x 5
##   datetime            Current_DC_A Power_DC_W Temperature_DC_C Voltage_DC_V
##   &lt;dttm&gt;                     &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
## 1 2015-01-01 07:47:00       0.0725       1.70              6           23.4
## 2 2015-01-01 07:48:00       0.0775       1.81              5.9         23.3
## 3 2015-01-01 07:49:00       0.0825       1.93              5.9         23.4
## 4 2015-01-01 07:50:00       0.0875       2.05              5.8         23.4
## 5 2015-01-01 07:51:00       0.095        2.22              5.7         23.4
## 6 2015-01-01 07:52:00       0.1          2.34              5.7         23.4</code></pre>
<div id="linear-regression" class="section level4">
<h4><span class="header-section-number">2.4.1.1</span> Linear regression</h4>
<p>En el primer modelo intentamos explicar Power_DC_W en función de las otras tres variables</p>
<pre class="sourceCode r"><code class="sourceCode r">model_lr_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data =</span> train_period_A, Power_DC_W <span class="op">~</span><span class="st"> </span>Current_DC_A <span class="op">+</span><span class="st"> </span>Temperature_DC_C <span class="op">+</span><span class="st"> </span>Voltage_DC_V)
<span class="kw">print</span>(model_lr_<span class="dv">1</span>)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Power_DC_W ~ Current_DC_A + Temperature_DC_C + Voltage_DC_V, 
##     data = train_period_A)
## 
## Coefficients:
##      (Intercept)      Current_DC_A  Temperature_DC_C      Voltage_DC_V  
##         -26.3277           27.8013           -0.1674            1.1714</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(model_lr_<span class="dv">1</span>)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Power_DC_W ~ Current_DC_A + Temperature_DC_C + Voltage_DC_V, 
##     data = train_period_A)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -47.199  -2.103  -0.400   1.312  24.317 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      -2.633e+01  7.359e-02  -357.7   &lt;2e-16 ***
## Current_DC_A      2.780e+01  3.166e-03  8781.0   &lt;2e-16 ***
## Temperature_DC_C -1.674e-01  8.502e-04  -196.9   &lt;2e-16 ***
## Voltage_DC_V      1.171e+00  2.636e-03   444.4   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.734 on 361001 degrees of freedom
## Multiple R-squared:  0.9972, Adjusted R-squared:  0.9972 
## F-statistic: 4.31e+07 on 3 and 361001 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Pues el modelo resultante en principio es muy bueno, ya que estamos hablando de un R cuadrado de casi 1. Y el p-value es pequeñísimo. Aparecen las tres variables como significativas.</p>
<p>Vamos a calcular el MAE, que forzosamente tendrá que ser muy bajo.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Extraemos los fitted_values (las predicciones) del modelo para compararlos con los valores reales</span>

predicted_values &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(model_lr_<span class="dv">1</span><span class="op">$</span>fitted.values)
real_values &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(train_period_A<span class="op">$</span>Power_DC_W)

mae_train &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(predicted_values,
                         real_values) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                         </span><span class="kw">rename</span>(<span class="dt">predicted_values =</span> <span class="st">&#39;model_lr_1$fitted.values&#39;</span>,
                                <span class="dt">real_values =</span> <span class="st">&#39;train_period_A$Power_DC_W&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">                         </span><span class="kw">mutate</span>(<span class="dt">abs_error =</span> <span class="kw">abs</span>(real_values <span class="op">-</span><span class="st"> </span>predicted_values)) <span class="op">%&gt;%</span>
<span class="st">                         </span><span class="kw">summarise</span>(<span class="dt">mae =</span> <span class="kw">mean</span>(abs_error))
mae_train</code></pre>
<pre><code>##        mae
## 1 2.599066</code></pre>
<p>Utilizamos este modelo inicial para hacer las predicciones con el periodo de validación</p>
<pre class="sourceCode r"><code class="sourceCode r">validation_predicted_values &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(model_lr_<span class="dv">1</span>, validation_period_A))
validation_real_values &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(validation_period_A<span class="op">$</span>Power_DC_W)

mae_validation &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(validation_predicted_values,
                         validation_real_values) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                         </span><span class="kw">rename</span>(<span class="dt">predicted_values =</span> <span class="st">&#39;predict(model_lr_1, validation_period_A)&#39;</span>,
                                <span class="dt">real_values =</span> <span class="st">&#39;validation_period_A$Power_DC_W&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">                         </span><span class="kw">mutate</span>(<span class="dt">abs_error =</span> <span class="kw">abs</span>(real_values <span class="op">-</span><span class="st"> </span>predicted_values)) <span class="op">%&gt;%</span>
<span class="st">                         </span><span class="kw">summarise</span>(<span class="dt">mae =</span> <span class="kw">mean</span>(abs_error))
mae_validation</code></pre>
<pre><code>##        mae
## 1 2.691831</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">rss &lt;-<span class="st"> </span><span class="kw">sum</span>((validation_predicted_values <span class="op">-</span><span class="st"> </span>validation_real_values) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)  <span class="co">## residual sum of squares</span>
tss &lt;-<span class="st"> </span><span class="kw">sum</span>((validation_real_values <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(validation_real_values<span class="op">$</span><span class="st">`</span><span class="dt">validation_period_A$Power_DC_W</span><span class="st">`</span>)) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)  <span class="co">## total sum of squares</span>
R_Squared &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rss<span class="op">/</span>tss
R_Squared</code></pre>
<pre><code>## [1] 0.9974431</code></pre>
<p>Al validar el modelo con el último trimestre de 2016 obtenemos resultados muy parecidos. El modelo es casi perfecto. Y no hemos necesitado utilizar la tabla con datos meteorológicos. ¿Qué está pasando?</p>
<pre class="sourceCode r"><code class="sourceCode r">model_lr_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data =</span> train_period_A, Power_DC_W <span class="op">~</span><span class="st"> </span>Current_DC_A)
<span class="kw">print</span>(model_lr_<span class="dv">2</span>)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Power_DC_W ~ Current_DC_A, data = train_period_A)
## 
## Coefficients:
##  (Intercept)  Current_DC_A  
##       0.7936       27.8372</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(model_lr_<span class="dv">2</span>)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Power_DC_W ~ Current_DC_A, data = train_period_A)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -57.135  -2.065  -0.773   2.152  30.051 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   0.793620   0.013956   56.87   &lt;2e-16 ***
## Current_DC_A 27.837231   0.003179 8755.82   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.845 on 361003 degrees of freedom
## Multiple R-squared:  0.9953, Adjusted R-squared:  0.9953 
## F-statistic: 7.666e+07 on 1 and 361003 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">model_lr_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data =</span> train_period_A, Power_DC_W <span class="op">~</span><span class="st"> </span>Temperature_DC_C)
<span class="kw">print</span>(model_lr_<span class="dv">3</span>)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Power_DC_W ~ Temperature_DC_C, data = train_period_A)
## 
## Coefficients:
##      (Intercept)  Temperature_DC_C  
##          -30.427             4.446</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(model_lr_<span class="dv">3</span>)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Power_DC_W ~ Temperature_DC_C, data = train_period_A)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -167.315  -39.684   -3.898   40.017  271.442 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      -30.42716    0.33175  -91.72   &lt;2e-16 ***
## Temperature_DC_C   4.44553    0.01077  412.79   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 58.33 on 361003 degrees of freedom
## Multiple R-squared:  0.3207, Adjusted R-squared:  0.3207 
## F-statistic: 1.704e+05 on 1 and 361003 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">model_lr_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">data =</span> train_period_A, Power_DC_W <span class="op">~</span><span class="st"> </span>Voltage_DC_V)
<span class="kw">print</span>(model_lr_<span class="dv">4</span>)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Power_DC_W ~ Voltage_DC_V, data = train_period_A)
## 
## Coefficients:
##  (Intercept)  Voltage_DC_V  
##      -185.57         10.41</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(model_lr_<span class="dv">4</span>)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Power_DC_W ~ Voltage_DC_V, data = train_period_A)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -182.047  -57.724   -5.642   57.626  181.430 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -185.57192    1.20693  -153.8   &lt;2e-16 ***
## Voltage_DC_V   10.41414    0.04375   238.0   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 65.8 on 361003 degrees of freedom
## Multiple R-squared:  0.1357, Adjusted R-squared:  0.1356 
## F-statistic: 5.666e+04 on 1 and 361003 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
<div id="descripcion-de-la-generacion-de-los-modelos-con-bigml." class="section level2">
<h2><span class="header-section-number">2.5</span> Descripción de la generación de los modelos con BIGml.</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="planteamiento-del-reto-sunlab-.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
